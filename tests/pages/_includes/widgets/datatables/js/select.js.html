<script>
  /**
   * Utility for selecting data table rows.
   *
   * Note: This functionality currently expects the data table contains a single column of checkboxes.
   *
   * @param {object} config - Identifiers associated with the data table
   * @param {string} config.datatableId - Identifier for the data table
   * @param {string} config.deleteAllRowsId - Identifier for the delete all rows data control
   * @param {string} config.selectAllId - Identifier for the select all checkbox
   */
  var dataTableSelect = function (config) {
    var self = this;
    this.datatable = $(config.datatableId); // Data table container
    this.deleteAllRows = $(config.deleteAllRowsId); // Delete all rows control
    this.selectedRows = []; // Selected rows array
    this.selectAll = $(config.selectAllId); // Select all checkbox
    this.results = this.datatable.find('.datatable-pf-results-right'); // Toolbar results container
    this.table = this.datatable.find('table').DataTable(); // Data table
    this.tbody = this.datatable.find('tbody'); // Table body

    // Helper function to set selected array
    this.setRowSelected = function(el) {
      var index = $.inArray(el.value, self.selectedRows);
      if (index === -1) {
        self.selectedRows.push(el.value);
      } else {
        self.selectedRows.splice(index, 1);
      }
    };

    // Helper function to set selected rows text
    this.updateSelectedRowsText = function() {
      self.results.children('strong:first').text(self.selectedRows.length);
    };

    // Handle click on delete all rows control
    this.deleteAllRows.on('click', function() {
      // Reset selected array
      self.selectedRows = [];
      self.selectAll.get(0).checked = false; // Uncheck select all
      self.updateSelectedRowsText();
    });

    // Handle click on select all control
    this.selectAll.on('click', function() {
      // Retrieve all rows taking into account currently applied filter
      var rows = self.table.rows({'search': 'applied'}).nodes();

      // Reset selected array
      self.selectedRows = [];

      // Set all checkboxes selected
      $('input[type="checkbox"]', rows).prop('checked', this.checked). // set inputs as checked
        parents('tr')[this.checked ? 'addClass' : 'removeClass']('selected'); // set rows as selected

      // Set all rows selected
      if (this.checked) {
        $('input[type="checkbox"]', rows).each(function(index, el) {
          self.setRowSelected(el);
        });
      }
      self.updateSelectedRowsText();
    });

    // Handle click on row select
    this.tbody.on('click', 'input[type="checkbox"]', function() {
      // Retrieve all rows taking into account currently applied filter
      var rowsCount = self.table.rows({'search': 'applied'}).nodes().count();

      $(this).parents('tr')[this.checked ? 'addClass' : 'removeClass']('selected'); // Set row selected
      self.setRowSelected(this);
      self.updateSelectedRowsText();

      // Set select all checkbox
      self.selectAll.get(0).checked = (rowsCount === self.selectedRows.length) ? true : false;
    });

    // Initialize total rows text
    self.results.children('strong:last').text(function() {
      return self.table.rows({'search': 'applied'}).nodes().count();
    });

    // Initialize select all control
    this.selectAll.get(0).checked = false;
  };
</script>
